{% extends 'layout.html' %}

{% set title = 'Sites' %}

{% block nav %}
	<ul class="nav">
		<li><a href="/workspaces">Workspaces</a></li>
		<li><a href="/workspaces/{{ workspace.handle }}">{{ workspace.title }}</a></li>
	</ul>
{% endblock %}

{% block pagetitle %}
	<div class="pagetitle">
		<h1>{{ workspace.title }}</h1>
		{% include "_workspace_menu.html" %}
	</div>
{% endblock %}

{% block content %}
	<div class="content">
		<ul class="nav nav-tabs">
			<li><a href="collections">Data</a></li>
			<li class="active"><a href="#">Pages</a></li>
		</ul>
		<h3 class="muted">Web pages to surface data from collections</h3>

		{% if !site %}
			<p>Pages are not yet enabled for this workspace.</p><br>
			<form action="/workspaces/{{ workspace.handle }}/pages/initialize" method="POST">
				<button class="btn btn-primary" >Enable Pages</button>
			</form>
		{% else %}
			<table class="table">
				{% for page in pages %}
					<tr>
						<td><a href="/workspaces/{{ workspace.handle }}/pages/{{ page.id }}/edit">{{ page.title }}</a></td>
						<td>{{ page.url_path }}</td>
						<td>
							<a class="btn" href="/sites/{{ site.id }}/preview{{ page.preview_url }}" target="_blank">
								<i class="icon-play"></i>
								Preview
							</a>
							<a class="btn" href="/workspaces/{{ workspace.handle }}/pages/{{ page.id }}/edit">
								<i class="icon-pencil"></i>
								Edit
							</a>
							<form class="delete" action="/workspaces/{{ workspace.handle }}/pages/{{ page.id }}" method="post">
								<input type="hidden" name="_method" value="delete">
								<button type="submit" class="btn permission-administrator" href="/sites/{{ site.id }}/pages/{{ page.id }}/edit">
									<i class="icon-remove"></i>
									Delete
								</button>
							</form>
						</td>
					</tr>
				{% endfor %}
			</table>
			<a class="btn btn-primary" href="/workspaces/{{ workspace.handle }}/pages/new">New Page</a>
		{% endif %}
	</div>

{% endblock %}

{% block footer_js %}

	<script>
		var forms = document.querySelectorAll("form.delete");
		[].forEach.call(forms, function(form) {
			form.addEventListener("submit", function(e) {
				if (!confirm("Are you sure you want to delete this page?")) {
					e.preventDefault();
				}
			});
		});
	</script>

{% endblock %}


